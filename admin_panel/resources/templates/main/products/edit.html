{% extends 'common/home.html' %}
{% load static %}

{% block home %}
  <h1>Product editing</h1>

  {% if product %}
    {% include 'common/fileinput.html' with id='photo' photo=product.photoUrl %}
    <link href="{% static 'css/bootstrap-select.css' %}" rel="stylesheet">
    <script src="{% static 'js/bootstrap-select.js' %}"></script>

    <form method="post" action="{% url 'products_update' %}" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="form-group row">
        <label class="col-sm-2">Id:</label>
        <div class="col-sm-10">
          <input class="form-control" type="number" name="id" value="{{ product.id }}" readonly>
        </div>
      </div>

      <div class="form-group row">
        <label class="col-sm-2">Photo:</label>
        <div class="col-sm-10">
          <input type="hidden" name="photoUrl" value="{{ product.photoUrl|default:'' }}">
          <input class="form-control" id="photo" type="file" name="photo">
        </div>
      </div>

      <div class="form-group row">
        <label class="col-sm-2">Name:</label>
        <div class="col-sm-10">
          <input class="form-control" name="name" value="{{ product.name|default:'' }}">
          {% if nameError %}
            <div class="text-warning">{{ nameError }}</div>
          {% endif %}
        </div>
      </div>

      <div class="form-group row">
        <label class="col-sm-2">Description:</label>
        <div class="col-sm-10">
          <textarea class="form-control" name="description" rows="4">{{ product.description|default:'' }}</textarea>
          {% if descriptionError %}
            <div class="text-warning">{{ descriptionError }}</div>
          {% endif %}
        </div>
      </div>

      <div class="form-group row">
        <label class="col-sm-2">Category:</label>
        <div class="col-sm-10">
          <select class="form-control selectpicker" name="category" data-live-search="true" data-size="4">
            {% if not product.category %}<option selected>â€”</option>{% endif %}
            {% for category in categories %}
              <option value="{{ category.id }}"
                      {% if product.category and category == product.category %}selected{% endif %}>
                {{ category.name }}
              </option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div class="form-group row">
        <label class="col-sm-2">Price:</label>
        <div class="col-sm-10">
          <input class="form-control" type="number" name="price" value="{{ product.price|default:'' }}">
          {% if priceError %}
            <div class="text-warning">{{ priceError }}</div>
          {% endif %}
        </div>
      </div>

      <button class="btn btn-success" type="submit">Update</button>
    </form>

    <form method="get" action="{% url 'products' %}">
      <button class="btn btn-info" type="submit">Back</button>
    </form>

    <form method="post" action="{% url 'products_delete' %}">
      {% csrf_token %}
      <input type="hidden" name="id" value="{{ product.id }}">
      <button class="btn btn-danger" type="submit">Delete</button>
    </form>

  {% else %}
    <div class="alert alert-danger" role="alert">
      <h4 class="alert-heading">Error</h4>
      <hr>This product does not exist!
    </div>
  {% endif %}
{% endblock %}
